<html>
  <head>
    <title>Intelligent Metronome</title>
    <script src="index.js" charset="utf-8"></script>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
    <script src="https://code.createjs.com/soundjs-0.6.2.min.js"></script>
    <meta name="viewport" content="width=device-width">
    <script src = "https://www.youtube.com/iframe_api"></script>
    <script type="text/javascript">
      var player;
      
    </script>
  </head>

  <body>
    <!-- <iframe width="420" height="315" src="https://www.youtube.com/embed/XGSy3_Czz8k?enablejsapi=1" onStateChange="f()"></iframe> -->
    <!-- <div id="player"></div>   -->
    <div id="app"></div>
    <script>
      createjs.Sound.registerSound('audio/lowest.mp3', "Low");
      createjs.Sound.registerSound('audio/low.mp3', "High");

      app = Elm.Metronomes.embed(document.getElementById("app"));
      
      app.ports.click.subscribe(function(name) {
        createjs.Sound.play(name);
      });

// Callback for when the YouTube iFrame player is ready
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          // Set Player height and width
          height: '246',
          width: '437',
          // Set the id of the video to be played
          videoId: 'pG7_gceIFL4',
          events: {
            'onReady': onPlayerReady
            // You can add more event listeners here
          },
          playerVars: {
            // controls: 0,
            // disablekb: 1,
          }
        });
      };

      function onPlayerReady (){
        //add onStateChange event handler
        player.addEventListener("onStateChange","onPlayerStateChange");

        //add your own rate listener below:

      };

      function onPlayerStateChange(event){
        // Get current state
        var currentState;
        if (event.data == YT.PlayerState.ENDED){
          currentState = "Ended";
        } 
        else if (event.data == YT.PlayerState.PLAYING){
          currentState = "Playing";
          app.ports.youtubePlaying.send(null);
        } 
        else if (event.data == YT.PlayerState.PAUSED){
          currentState = "Paused";
          app.ports.youtubePaused.send(null);
        }  
        else if (event.data == YT.PlayerState.BUFFERING){
          currentState = "Buffering";
        }
        else if (event.data == YT.PlayerState.CUED){
          currentState = "Cued";
        } else{
          currentState = "Unknown";
        }

        currentState += " (" + event.data + ")"
        // Update video state div
        // document.getElementById('currentState').innerText = currentState;
        // alert(currentState);
      };

      app.ports.youtubePause.subscribe(function() {
        player.pauseVideo();
      });

      app.ports.youtubePlay.subscribe(function() {
        player.playVideo();
      });

      app.ports.youtubeStop.subscribe(function() {
        player.pauseVideo();
        player.seekTo(0, true);
      });
    </script>
  </body>
</html>
